# 이커머스 고객 지원 멀티 에이전트 시스템

## 📋 개요

Strands Agent SDK를 사용하여 이커머스 고객 지원 문의를 처리하는 **멀티 에이전트 아키텍처**의 개념 증명(PoC) 프로젝트입니다.

### 주요 특징
- ✅ **완전한 한국어 지원**: 모든 에이전트와 출력이 한국어로 제공
- ✅ **두 가지 아키텍처 패턴**: Agent-Tool 패턴 & Hybrid 패턴
- ✅ **실제 Strands SDK 구현**: 실제 AWS Bedrock Claude 모델 사용
- ✅ **프로덕션 준비 구조**: 확장 가능하고 유지보수 쉬운 설계

---

## 🏗️ 프로젝트 구조

```
21_customer_chat/
├── agent_tool_pattern/          # 패턴 1: Orchestrator + Tools
│   ├── orchestrator_agent.py   # 메인 라우터 에이전트
│   ├── sub_agent_orders.py     # 주문/배송 전문 에이전트
│   ├── sub_agent_returns.py    # 반품/결제 전문 에이전트
│   ├── main.py                 # 테스트 실행 스크립트
│   └── README.md
│
├── hybrid_pattern/              # 패턴 2: Graph + Hierarchical ⭐ 추천
│   ├── graphs/                 # 그래프 워크플로우
│   │   ├── main_graph.py      # 메인 그래프 (분류 → 라우팅)
│   │   ├── order_graph.py     # 주문/배송 서브그래프
│   │   └── return_graph.py    # 반품/환불 서브그래프
│   ├── agents/                 # 전문 에이전트들
│   │   ├── classifier_agent.py  # 문의 분류
│   │   ├── orders_agent.py      # 주문 처리
│   │   ├── shipping_agent.py    # 배송 관리
│   │   ├── returns_agent.py     # 반품 처리
│   │   └── payment_agent.py     # 결제/환불
│   ├── tools/                  # 도구 함수들
│   │   ├── order_tools.py
│   │   ├── shipping_tools.py
│   │   └── payment_tools.py
│   ├── hierarchies/            # 계층적 승인 시스템
│   │   └── approval_hierarchy.py
│   ├── main.py
│   └── README.md
│
├── setup/                       # 환경 설정
├── ARCHITECTURE_PATTERNS.md    # 모든 패턴 상세 설명
├── RECOMMENDED_PATTERN.md      # 추천 패턴 구현 가이드 ⭐
└── README.md                   # 이 파일
```

---

## 🎯 두 가지 패턴 비교

### 패턴 1️⃣: Agent-Tool 패턴 (간단한 라우팅)

**구조:**
```
     고객 문의
         ↓
  ┌──────────────┐
  │ Orchestrator │  ← 문의 분류 및 라우팅
  └──────────────┘
         ↓
    ┌────┴────┐
    ↓         ↓
┌────────┐ ┌─────────┐
│ 주문/배송│ │ 반품/결제│
│ 에이전트 │ │ 에이전트 │
└────────┘ └─────────┘
    ↓         ↓
   도구      도구
```

**특징:**
- ✅ 구현이 간단함
- ✅ 이해하기 쉬움
- ✅ 빠른 프로토타이핑
- ❌ 복잡한 비즈니스 로직 처리 어려움
- ❌ 조건부 분기 제한적
- ❌ 에이전트 간 협력 제한적

**적합한 경우:**
- 간단한 문의 라우팅
- PoC 및 데모
- 복잡하지 않은 워크플로우

---

### 패턴 2️⃣: Hybrid 패턴 (Graph + Hierarchical) ⭐ **추천**

**구조:**
```
                고객 문의
                    ↓
            ┌──────────────┐
            │ 분류 에이전트  │
            └───────┬───────┘
                    ↓
        ┌───────────┴───────────┐
        ↓                       ↓
  ┌──────────┐          ┌──────────┐
  │ 주문 그래프│          │ 반품 그래프│
  └──────────┘          └──────────┘
        ↓                       ↓
  ┌──────────┐          ┌──────────┐
  │ 주문 에이전트│        │ 반품 에이전트│
  │ 배송 에이전트│        │ 결제 에이전트│
  └──────────┘          └──────────┘
        ↓                       ↓
  ┌─────────────────────────────┐
  │    계층적 승인 시스템          │
  │ 일반상담원 → 관리자 → 이사     │
  └───────────┬─────────────────┘
              ↓
         최종 응답
```

**특징:**
- ✅ 복잡한 비즈니스 로직 처리
- ✅ 조건부 워크플로우 (주문 상태에 따른 다른 처리)
- ✅ 계층적 승인 (환불 금액에 따른 자동 에스컬레이션)
- ✅ 여러 에이전트 간 순차적 협력
- ✅ 상태 공유 및 컨텍스트 전달
- ✅ 프로덕션 환경에 적합

**적합한 경우:**
- 복잡한 고객 지원 시나리오
- 승인 프로세스가 필요한 경우
- 여러 단계의 처리가 필요한 경우
- 실제 프로덕션 환경

**주요 기능:**

1. **조건부 분기**
   ```
   주문 상태 = "배송 전" → 즉시 취소 → 환불
   주문 상태 = "배송 중" → 배송 중지 시도 → 관리자 승인
   주문 상태 = "배송 완료" → 반품 프로세스
   ```

2. **계층적 승인**
   ```
   환불 50,000원 이하 → 일반 상담원
   환불 50,000~100,000원 → 관리자 승인
   환불 100,000원 이상 → 이사 승인
   ```

3. **멀티 에이전트 협력**
   ```
   분류 → 주문 → 배송 → 결제 → 승인 → 최종 응답
   ```

---

## 🚀 설치 및 실행

### 사전 요구사항

- **Python 3.11 이상**
- **AWS 계정** (Bedrock 액세스 권한 필요)
- **AWS 자격 증명 설정** (`aws configure` 또는 환경 변수)
- **Git**

### 방법 1: 자동 설치 (추천) ⭐

```bash
# 1. setup 디렉토리로 이동
cd setup

# 2. 환경 생성 스크립트 실행
./create_env.sh customer_chat 3.11

# 3. 상위 디렉토리로 돌아가기
cd ..
```

**스크립트가 자동으로 수행하는 작업:**
- ✅ UV 패키지 매니저 설치/확인
- ✅ Python 3.11 가상 환경 생성 (`.venv`)
- ✅ Strands Agent SDK 설치
- ✅ 모든 필수 의존성 설치 (boto3, asyncio 등)
- ✅ Jupyter 커널 등록
- ✅ 프로젝트 루트에 심링크 생성


## 💻 사용 방법

### Agent-Tool 패턴 실행

```bash
cd agent_tool_pattern
uv run python main.py
```

**코드에서 사용:**
```python
from agent_tool_pattern.orchestrator_agent import handle_customer_query

response = handle_customer_query("주문번호 ORD12345는 어디에 있나요?")
print(response)
```

### Hybrid 패턴 실행 ⭐ 추천

```bash
cd hybrid_pattern
uv run python main.py
```

**코드에서 사용:**
```python
import asyncio
from hybrid_pattern.graphs.main_graph import execute_customer_support

async def main():
    result = await execute_customer_support("주문 취소하고 환불 받고 싶어요")

    print(f"카테고리: {result['카테고리']}")
    print(f"상태: {result['상태']}")
    print(f"사용된 그래프: {result['사용된_그래프']}")
    print(f"메시지: {result['메시지']}")

asyncio.run(main())
```

---

## 📊 테스트 시나리오

### Agent-Tool 패턴 테스트

**주문/배송 문의:**
```python
"주문번호 ORD12345는 어디에 있나요? 아직 받지 못했어요."
"운송장번호 TRK987654로 택배 추적해주실 수 있나요?"
```

**반품/결제 문의:**
```python
"주문번호 ORD67890 상품이 안 맞아서 반품하고 싶어요."
"주문번호 ORD11111 환불이 처리되었나요?"
"주문번호 ORD22222를 다른 사이즈로 교환하고 싶습니다."
```

### Hybrid 패턴 테스트

프로젝트에 포함된 4가지 실제 시나리오:

1. **주문 취소 (배송 전)**
   - 문의: "주문번호 ORD12345를 취소하고 환불 받고 싶어요"
   - 흐름: 분류 → 주문그래프 → 주문에이전트 → 관리자 승인
   - 결과: ✅ 성공

2. **주문 취소 (배송 중)**
   - 문의: "배송 중인 주문을 취소하고 싶은데 가능한가요?"
   - 흐름: 분류 → 주문그래프 → 주문+배송 에이전트 → 관리자 승인
   - 결과: ✅ 성공 (배송 중지 또는 수령 거부 안내)

3. **반품 요청**
   - 문의: "주문번호 ORD67890 상품이 불량이라서 반품하고 싶어요"
   - 흐름: 분류 → 반품그래프 → 반품 에이전트
   - 결과: ✅ 성공

4. **고액 환불**
   - 문의: "15만원 주문을 환불 받고 싶어요"
   - 흐름: 분류 → 반품그래프 → 반품+결제 에이전트 → 이사 승인
   - 결과: ✅ 성공 (120,000원 → 이사 레벨 에스컬레이션)

---

## 🎨 실행 예시

### Agent-Tool 패턴 출력

```
============================================================
[오케스트레이터] 고객 문의 접수: 주문번호 ORD12345는 어디에 있나요?
============================================================
[오케스트레이터] 주문/배송 상담원으로 전달 중

[Sub-Agent-01: Orders] Handling query: 주문번호 ORD12345는 어디에 있나요?
[도구] 주문 상태 확인 중 - 주문번호: ORD12345

응답: 주문번호 ORD12345의 배송 상황을 확인해드렸습니다!

**현재 상태**: 배송 중
**예상 도착일**: 2일 후

더 자세한 배송 위치를 확인하고 싶으시다면 배송 추적번호를 알려주시면
실시간 배송 위치를 확인해드릴 수 있습니다.
```

### Hybrid 패턴 출력

```
================================================================================
[메인 그래프] 고객 문의 처리 시작
문의: 주문 취소하고 환불 받고 싶어요
================================================================================

[단계 1] 분류 에이전트 호출
[분류 에이전트] 문의 분석 중...
[분류 에이전트] 분류 결과: 취소

[단계 2] 서브 그래프 라우팅
[단계 2] 라우팅 대상: 주문_그래프

[단계 3] 서브 그래프 실행 중...

============================================================
[주문 그래프] 실행 시작
============================================================

[단계 1] 주문 에이전트 호출
[도구] 주문 상태 확인 중 - 주문번호: ORD12345
[단계 1] 주문 에이전트 응답 완료

[단계 3] 에스컬레이션 필요: 관리자 레벨

============================================================
[주문 그래프] 처리 완료
============================================================

[단계 4] 최종 응답 생성

================================================================================
[메인 그래프] 처리 완료
================================================================================

결과:
  - 카테고리: 취소
  - 상태: 완료
  - 메시지: 고객 문의가 성공적으로 처리되었습니다.
  - 사용된 그래프: 주문_그래프
```

---

## ✨ 주요 기능

### 공통 기능

- ✅ **완전한 한국어 지원**: 모든 출력이 한국어로 표시
- ✅ **실제 LLM 응답**: AWS Bedrock Claude Sonnet 4.5 사용
- ✅ **도구 통합**: @tool 데코레이터를 통한 함수 호출
- ✅ **Strands SDK**: 실제 SDK 구현

### Agent-Tool 패턴 특화

- ✅ **간단한 라우팅**: 문의 유형에 따른 즉시 라우팅
- ✅ **전문 에이전트**: 주문/배송, 반품/결제 전문가
- ✅ **빠른 응답**: 단순한 플로우로 빠른 처리

### Hybrid 패턴 특화

- ✅ **조건부 워크플로우**: 상태에 따른 다른 처리
- ✅ **계층적 승인**: 자동 에스컬레이션 시스템
- ✅ **멀티 에이전트 협력**: 여러 에이전트 순차 실행
- ✅ **상태 공유**: 컨텍스트를 통한 정보 전달
- ✅ **복잡한 비즈니스 로직**: 실제 프로덕션 시나리오 처리

---

