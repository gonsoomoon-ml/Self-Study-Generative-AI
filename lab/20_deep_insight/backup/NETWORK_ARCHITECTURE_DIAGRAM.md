# Bedrock AgentCore - Network Architecture Diagrams

## ğŸ“Š Architecture Comparison: Current vs VPC Private

---

## 1ï¸âƒ£ Current Production Architecture (Public IP)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          AWS Account (057716757052)                      â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    AWS Managed Infrastructure                       â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚ â”‚
â”‚  â”‚    â”‚  Bedrock AgentCore Runtime               â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚  (AWS Managed - Public Mode)             â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚                                           â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚  â€¢ Supervisor Agent                       â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚  â€¢ Coder Agent                            â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚  â€¢ Validator Agent                        â”‚                    â”‚ â”‚
â”‚  â”‚    â”‚  â€¢ Reporter Agent                         â”‚                    â”‚ â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â”‚
â”‚  â”‚                       â”‚                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                                â”‚
â”‚                          â”‚ âŒ Public Internet                             â”‚
â”‚                          â”‚ (AWS Backbone, but public IP)                 â”‚
â”‚                          â”‚                                                â”‚
â”‚                          â†“                                                â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚         ğŸŒ Public Internet Gateway             â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                          â”‚                                                â”‚
â”‚                          â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     VPC (vpc-ff5e1585)                             â”‚  â”‚
â”‚  â”‚                     CIDR: 172.31.0.0/16                            â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚    â”‚  Internet-Facing ALB                                  â”‚     â”‚  â”‚
â”‚  â”‚    â”‚  fargate-flask-alb.us-east-1.elb.amazonaws.com        â”‚     â”‚  â”‚
â”‚  â”‚    â”‚                                                         â”‚     â”‚  â”‚
â”‚  â”‚    â”‚  â€¢ Public DNS: âœ…                                      â”‚     â”‚  â”‚
â”‚  â”‚    â”‚  â€¢ Public IP: 54.x.x.x, 100.x.x.x                     â”‚     â”‚  â”‚
â”‚  â”‚    â”‚  â€¢ Security Group: sg-0846b19e45a3af6d1               â”‚     â”‚  â”‚
â”‚  â”‚    â”‚    - Inbound: 0.0.0.0/0 â†’ 80 (âš ï¸ Wide open)           â”‚     â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                          â”‚                                          â”‚  â”‚
â”‚  â”‚                          â”‚ Private IP (172.31.x.x)                 â”‚  â”‚
â”‚  â”‚                          â”‚                                          â”‚  â”‚
â”‚  â”‚                          â†“                                          â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚    â”‚  Target Group: fargate-flask-tg-default               â”‚     â”‚  â”‚
â”‚  â”‚    â”‚  â€¢ Protocol: HTTP:8080                                 â”‚     â”‚  â”‚
â”‚  â”‚    â”‚  â€¢ Sticky Sessions: 24h                                â”‚     â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                          â”‚                                          â”‚  â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚         â”‚                â”‚                 â”‚              â”‚        â”‚  â”‚
â”‚  â”‚         â†“                â†“                 â†“              â†“        â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚    â”‚ Fargate â”‚      â”‚ Fargate â”‚      â”‚ Fargate â”‚   â”‚ Fargate â”‚  â”‚  â”‚
â”‚  â”‚    â”‚  Task 1 â”‚      â”‚  Task 2 â”‚      â”‚  Task 3 â”‚   â”‚  Task N â”‚  â”‚  â”‚
â”‚  â”‚    â”‚         â”‚      â”‚         â”‚      â”‚         â”‚   â”‚         â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ Private â”‚      â”‚ Private â”‚      â”‚ Private â”‚   â”‚ Private â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ IP: x.1 â”‚      â”‚ IP: x.2 â”‚      â”‚ IP: x.3 â”‚   â”‚ IP: x.N â”‚  â”‚  â”‚
â”‚  â”‚    â”‚         â”‚      â”‚         â”‚      â”‚         â”‚   â”‚         â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ Public  â”‚      â”‚ Public  â”‚      â”‚ Public  â”‚   â”‚ Public  â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ IP: âœ…  â”‚      â”‚ IP: âœ…  â”‚      â”‚ IP: âœ…  â”‚   â”‚ IP: âœ…  â”‚  â”‚  â”‚
â”‚  â”‚    â”‚         â”‚      â”‚         â”‚      â”‚         â”‚   â”‚         â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ SG:     â”‚      â”‚ SG:     â”‚      â”‚ SG:     â”‚   â”‚ SG:     â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ sg-05d4 â”‚      â”‚ sg-05d4 â”‚      â”‚ sg-05d4 â”‚   â”‚ sg-05d4 â”‚  â”‚  â”‚
â”‚  â”‚    â”‚         â”‚      â”‚         â”‚      â”‚         â”‚   â”‚         â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ ECR â†’   â”‚      â”‚ ECR â†’   â”‚      â”‚ ECR â†’   â”‚   â”‚ ECR â†’   â”‚  â”‚  â”‚
â”‚  â”‚    â”‚ S3 â†’    â”‚      â”‚ S3 â†’    â”‚      â”‚ S3 â†’    â”‚   â”‚ S3 â†’    â”‚  â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚         â”‚                â”‚                 â”‚              â”‚        â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚                          â”‚                                          â”‚  â”‚
â”‚  â”‚                          â†“ Public Internet                         â”‚  â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚         â”‚  External Services                             â”‚        â”‚  â”‚
â”‚  â”‚         â”‚  â€¢ ECR: 057716757052.dkr.ecr.us-east-1...      â”‚        â”‚  â”‚
â”‚  â”‚         â”‚  â€¢ S3: bedrock-logs-gonsoomoon                 â”‚        â”‚  â”‚
â”‚  â”‚         â”‚  â€¢ CloudWatch Logs                             â”‚        â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Network Flow:
  1. AgentCore invokes tool â†’ Public Internet â†’ ALB Public IP
  2. ALB â†’ Private IP â†’ Fargate Task
  3. Fargate â†’ Public Internet â†’ ECR/S3/CloudWatch

Security Concerns:
  âš ï¸  AgentCore â†’ ALB: Uses public IP (AWS backbone, but exposed)
  âš ï¸  ALB Security Group: Wide open (0.0.0.0/0)
  âš ï¸  Fargate has public IPs for ECR/S3 access
```

---

## 2ï¸âƒ£ New VPC Private Architecture (Target)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          AWS Account (057716757052)                      â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         VPC (vpc-ff5e1585)                          â”‚ â”‚
â”‚  â”‚                         CIDR: 172.31.0.0/16                         â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚             VPC Endpoints (AWS PrivateLink)                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  com.amazonaws.us-east-1.bedrock-agentcore             â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  (Data Plane)                                           â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ ENI in Private Subnet A: 172.31.x.1                 â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ ENI in Private Subnet B: 172.31.x.2                 â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Private DNS: âœ… Enabled                             â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                           â”‚                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  com.amazonaws.us-east-1.bedrock-agentcore.gateway     â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  (Gateway)                                              â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ ENI in Private Subnet A: 172.31.y.1                 â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ ENI in Private Subnet B: 172.31.y.2                 â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Private DNS: âœ… Enabled                             â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                           â”‚                                         â”‚ â”‚
â”‚  â”‚                           â”‚ âœ… AWS PrivateLink                      â”‚ â”‚
â”‚  â”‚                           â”‚ (Private connection)                    â”‚ â”‚
â”‚  â”‚                           â”‚                                         â”‚ â”‚
â”‚  â”‚                           â†“                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚    Bedrock AgentCore Runtime (VPC Mode)                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â”‚  ENI in Private Subnet A                          â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â”‚  Private IP: 172.31.a.1                           â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â”‚  Security Group: test-vpc-private-agentcore-sg    â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                           â”‚                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â”‚  ENI in Private Subnet B                          â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â”‚  Private IP: 172.31.b.1                           â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â”‚  Security Group: test-vpc-private-agentcore-sg    â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ Supervisor Agent                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ Coder Agent                                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ Validator Agent                                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ Reporter Agent                                          â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                           â”‚                                         â”‚ â”‚
â”‚  â”‚                           â”‚ âœ… Private IP (172.31.x.x)              â”‚ â”‚
â”‚  â”‚                           â”‚ (No internet traversal)                 â”‚ â”‚
â”‚  â”‚                           â”‚                                         â”‚ â”‚
â”‚  â”‚                           â†“                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚    Internal Application Load Balancer                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    test-vpc-private-alb.us-east-1.elb.amazonaws.com          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ Scheme: internal (âŒ No public IP)                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ Security Group: test-vpc-private-alb-sg                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      - Inbound: Only from AgentCore SG â†’ 80                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚      - Outbound: Only to Fargate SG â†’ 8080                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â”‚  ENI in Private Subnet A: 172.31.c.1              â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                           â”‚                                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â”‚  ENI in Private Subnet B: 172.31.c.2              â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                           â”‚                                         â”‚ â”‚
â”‚  â”‚                           â”‚ âœ… Private IP (172.31.x.x)              â”‚ â”‚
â”‚  â”‚                           â”‚                                         â”‚ â”‚
â”‚  â”‚                           â†“                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚    Target Group: test-vpc-private-tg                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ Protocol: HTTP:8080                                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â€¢ Sticky Sessions: 24h                                    â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                           â”‚                                         â”‚ â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚         â”‚                 â”‚                 â”‚              â”‚      â”‚ â”‚
â”‚  â”‚         â†“                 â†“                 â†“              â†“      â”‚ â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚    â”‚ Fargate â”‚      â”‚ Fargate â”‚      â”‚ Fargate â”‚   â”‚ Fargate â”‚  â”‚ â”‚
â”‚  â”‚    â”‚  Task 1 â”‚      â”‚  Task 2 â”‚      â”‚  Task 3 â”‚   â”‚  Task N â”‚  â”‚ â”‚
â”‚  â”‚    â”‚         â”‚      â”‚         â”‚      â”‚         â”‚   â”‚         â”‚  â”‚ â”‚
â”‚  â”‚    â”‚ Private â”‚      â”‚ Private â”‚      â”‚ Private â”‚   â”‚ Private â”‚  â”‚ â”‚
â”‚  â”‚    â”‚ IP: x.1 â”‚      â”‚ IP: x.2 â”‚      â”‚ IP: x.3 â”‚   â”‚ IP: x.N â”‚  â”‚ â”‚
â”‚  â”‚    â”‚         â”‚      â”‚         â”‚      â”‚         â”‚   â”‚         â”‚  â”‚ â”‚
â”‚  â”‚    â”‚ Public  â”‚      â”‚ Public  â”‚      â”‚ Public  â”‚   â”‚ Public  â”‚  â”‚ â”‚
â”‚  â”‚    â”‚ IP: âœ…* â”‚      â”‚ IP: âœ…* â”‚      â”‚ IP: âœ…* â”‚   â”‚ IP: âœ…* â”‚  â”‚ â”‚
â”‚  â”‚    â”‚ *For    â”‚      â”‚ *For    â”‚      â”‚ *For    â”‚   â”‚ *For    â”‚  â”‚ â”‚
â”‚  â”‚    â”‚  ECR    â”‚      â”‚  ECR    â”‚      â”‚  ECR    â”‚   â”‚  ECR    â”‚  â”‚ â”‚
â”‚  â”‚    â”‚         â”‚      â”‚         â”‚      â”‚         â”‚   â”‚         â”‚  â”‚ â”‚
â”‚  â”‚    â”‚ SG:     â”‚      â”‚ SG:     â”‚      â”‚ SG:     â”‚   â”‚ SG:     â”‚  â”‚ â”‚
â”‚  â”‚    â”‚ test-   â”‚      â”‚ test-   â”‚      â”‚ test-   â”‚   â”‚ test-   â”‚  â”‚ â”‚
â”‚  â”‚    â”‚ fargate â”‚      â”‚ fargate â”‚      â”‚ fargate â”‚   â”‚ fargate â”‚  â”‚ â”‚
â”‚  â”‚    â”‚ -sg     â”‚      â”‚ -sg     â”‚      â”‚ -sg     â”‚   â”‚ -sg     â”‚  â”‚ â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚         â”‚                â”‚                 â”‚              â”‚        â”‚ â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚  â”‚                          â”‚                                          â”‚ â”‚
â”‚  â”‚                          â”‚ âœ… Via VPC Endpoints (Private)           â”‚ â”‚
â”‚  â”‚                          â†“                                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚         VPC Endpoints for AWS Services                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ com.amazonaws.us-east-1.ecr.api (ECR API)                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ com.amazonaws.us-east-1.ecr.dkr (ECR Docker)             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ com.amazonaws.us-east-1.s3 (S3 Gateway Endpoint)         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ com.amazonaws.us-east-1.logs (CloudWatch Logs)           â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Network Flow:
  1. AgentCore (VPC Mode) â†’ VPC Endpoint â†’ Private IP â†’ AgentCore Service
  2. AgentCore (VPC Mode) â†’ Private IP â†’ Internal ALB
  3. Internal ALB â†’ Private IP â†’ Fargate Task
  4. Fargate â†’ VPC Endpoints â†’ ECR/S3/CloudWatch (all private)

Security Benefits:
  âœ… AgentCore â†’ ALB: 100% Private (no internet exposure)
  âœ… ALB Security Group: Restricted to AgentCore SG only
  âœ… All traffic stays within AWS backbone (VPC)
  âœ… No public IPs needed for AgentCore â†” Fargate communication
  âœ… Compliance-ready (private-only network)
```

---

## 3ï¸âƒ£ Detailed Security Group Rules

### Current Production

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ALB Security Group: sg-0846b19e45a3af6d1                  â”‚
â”‚                                                             â”‚
â”‚  Inbound:                                                   â”‚
â”‚    HTTP (80) â† 0.0.0.0/0               âš ï¸ Wide open        â”‚
â”‚                                                             â”‚
â”‚  Outbound:                                                  â”‚
â”‚    HTTP (8080) â†’ sg-05d4ccf6d9cfde284  âœ… To Fargate       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fargate Security Group: sg-05d4ccf6d9cfde284              â”‚
â”‚                                                             â”‚
â”‚  Inbound:                                                   â”‚
â”‚    HTTP (8080) â† sg-0846b19e45a3af6d1  âœ… From ALB only    â”‚
â”‚                                                             â”‚
â”‚  Outbound:                                                  â”‚
â”‚    ALL â†’ 0.0.0.0/0                     âš ï¸ Internet access  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### New VPC Private

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AgentCore SG: test-vpc-private-agentcore-sg               â”‚
â”‚                                                             â”‚
â”‚  Inbound:                                                   â”‚
â”‚    (None - AgentCore initiates all connections)            â”‚
â”‚                                                             â”‚
â”‚  Outbound:                                                  â”‚
â”‚    HTTP (80) â†’ test-vpc-private-alb-sg    âœ… To ALB only   â”‚
â”‚    HTTPS (443) â†’ VPC Endpoints            âœ… To Bedrock    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Internal ALB SG: test-vpc-private-alb-sg                  â”‚
â”‚                                                             â”‚
â”‚  Inbound:                                                   â”‚
â”‚    HTTP (80) â† test-vpc-private-agentcore-sg               â”‚
â”‚                                  âœ… From AgentCore only     â”‚
â”‚                                                             â”‚
â”‚  Outbound:                                                  â”‚
â”‚    HTTP (8080) â†’ test-vpc-private-fargate-sg               â”‚
â”‚                                  âœ… To Fargate only         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fargate SG: test-vpc-private-fargate-sg                   â”‚
â”‚                                                             â”‚
â”‚  Inbound:                                                   â”‚
â”‚    HTTP (8080) â† test-vpc-private-alb-sg                   â”‚
â”‚                                  âœ… From ALB only           â”‚
â”‚                                                             â”‚
â”‚  Outbound:                                                  â”‚
â”‚    HTTPS (443) â†’ VPC Endpoints    âœ… Private AWS services  â”‚
â”‚    ALL â†’ 0.0.0.0/0                âœ… For ECR/S3 (optional)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Security Improvement:**
- âœ… **Zero Trust Model**: Each SG only allows traffic from specific source SG
- âœ… **Principle of Least Privilege**: Minimal required ports open
- âœ… **Defense in Depth**: Multiple layers of security controls

---

## 4ï¸âƒ£ Network Flow Sequence Diagrams

### Current Flow: Tool Invocation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AgentCoreâ”‚    â”‚ Internetâ”‚    â”‚   ALB   â”‚    â”‚ Fargate  â”‚
â”‚ Runtime  â”‚    â”‚ Gateway â”‚    â”‚ Public  â”‚    â”‚   Task   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚              â”‚              â”‚
     â”‚ 1. Invoke Tool (HTTP POST)   â”‚              â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>              â”‚
     â”‚               â”‚ Public IP    â”‚              â”‚
     â”‚               â”‚              â”‚              â”‚
     â”‚               â”‚ 2. Forward   â”‚              â”‚
     â”‚               â”‚ (Private IP) â”‚              â”‚
     â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>              â”‚
     â”‚               â”‚              â”‚              â”‚
     â”‚               â”‚              â”‚ 3. Execute   â”‚
     â”‚               â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
     â”‚               â”‚              â”‚              â”‚
     â”‚               â”‚              â”‚ 4. Result    â”‚
     â”‚               â”‚              <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚               â”‚              â”‚              â”‚
     â”‚               â”‚ 5. Response  â”‚              â”‚
     â”‚               <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
     â”‚               â”‚              â”‚              â”‚
     â”‚ 6. Result (HTTP 200)         â”‚              â”‚
     <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
     â”‚               â”‚ Public IP    â”‚              â”‚
     â”‚               â”‚              â”‚              â”‚

âš ï¸  Steps 1 & 6 traverse public internet (AWS backbone, but exposed)
```

### New VPC Private Flow: Tool Invocation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AgentCoreâ”‚    â”‚   VPC    â”‚    â”‚ Internal â”‚    â”‚ Fargate  â”‚
â”‚ Runtime  â”‚    â”‚ Endpoint â”‚    â”‚   ALB    â”‚    â”‚   Task   â”‚
â”‚ (VPC)    â”‚    â”‚          â”‚    â”‚          â”‚    â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚              â”‚              â”‚
     â”‚ 1. Connect to Bedrock (via VPC Endpoint)   â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>              â”‚              â”‚
     â”‚ Private IP    â”‚              â”‚              â”‚
     â”‚               â”‚              â”‚              â”‚
     â”‚ 2. Invoke Tool (HTTP POST to Internal ALB) â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>              â”‚
     â”‚               â”‚ Private IP   â”‚              â”‚
     â”‚               â”‚              â”‚              â”‚
     â”‚               â”‚              â”‚ 3. Execute   â”‚
     â”‚               â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
     â”‚               â”‚              â”‚ Private IP   â”‚
     â”‚               â”‚              â”‚              â”‚
     â”‚               â”‚              â”‚ 4. Result    â”‚
     â”‚               â”‚              <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚               â”‚              â”‚              â”‚
     â”‚               â”‚ 5. Response  â”‚              â”‚
     â”‚               â”‚ (Private IP) â”‚              â”‚
     â”‚               <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
     â”‚               â”‚              â”‚              â”‚
     â”‚ 6. Result (HTTP 200)         â”‚              â”‚
     <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
     â”‚               â”‚ Private IP   â”‚              â”‚
     â”‚               â”‚              â”‚              â”‚

âœ… All traffic stays within VPC - 100% private communication
```

---

## 5ï¸âƒ£ Data Flow: File Upload to S3

### Current Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fargate  â”‚    â”‚ Internetâ”‚    â”‚    S3    â”‚    â”‚   User  â”‚
â”‚   Task   â”‚    â”‚ Gateway â”‚    â”‚  Bucket  â”‚    â”‚         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚               â”‚              â”‚              â”‚
     â”‚ 1. Generate Report PDF       â”‚              â”‚
     â”‚               â”‚              â”‚              â”‚
     â”‚ 2. Upload to S3 (Public Internet)          â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>              â”‚
     â”‚ Public IP     â”‚              â”‚              â”‚
     â”‚               â”‚              â”‚              â”‚
     â”‚               â”‚              â”‚ 3. User Downloads
     â”‚               â”‚              <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚               â”‚              â”‚ Public       â”‚
     â”‚               â”‚              â”‚ Internet     â”‚
     â”‚               â”‚              â”‚              â”‚

âš ï¸  Fargate â†’ S3 uses public internet (even with Public IP on task)
```

### New VPC Private Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fargate  â”‚    â”‚   VPC    â”‚    â”‚    S3    â”‚    â”‚   User  â”‚
â”‚   Task   â”‚    â”‚ Endpoint â”‚    â”‚  Bucket  â”‚    â”‚         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚               â”‚              â”‚              â”‚
     â”‚ 1. Generate Report PDF       â”‚              â”‚
     â”‚               â”‚              â”‚              â”‚
     â”‚ 2. Upload to S3 (via VPC Endpoint)         â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>              â”‚              â”‚
     â”‚ Private IP    â”‚              â”‚              â”‚
     â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>              â”‚
     â”‚               â”‚ Private      â”‚              â”‚
     â”‚               â”‚              â”‚              â”‚
     â”‚               â”‚              â”‚ 3. User Downloads
     â”‚               â”‚              <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚               â”‚              â”‚ Public       â”‚
     â”‚               â”‚              â”‚ Internet     â”‚
     â”‚               â”‚              â”‚              â”‚

âœ… Fargate â†’ S3 stays within AWS network (via VPC Endpoint)
```

---

## 6ï¸âƒ£ Cost Comparison

### Current Production (Monthly)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Resource                          â”‚  Cost/Month              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Internet-Facing ALB               â”‚  $16.20                  â”‚
â”‚  â€¢ Base: $0.0225/hour Ã— 720h       â”‚                          â”‚
â”‚                                    â”‚                          â”‚
â”‚  ALB Data Processing               â”‚  Variable                â”‚
â”‚  â€¢ $0.008/GB processed             â”‚  ~$5-10 (estimate)       â”‚
â”‚                                    â”‚                          â”‚
â”‚  Fargate Tasks (on-demand)         â”‚  Variable                â”‚
â”‚  â€¢ 256 CPU, 512 MB                 â”‚  $0.01/hour Ã— usage      â”‚
â”‚  â€¢ Dynamic scaling                 â”‚                          â”‚
â”‚                                    â”‚                          â”‚
â”‚  Data Transfer OUT (to internet)   â”‚  Variable                â”‚
â”‚  â€¢ $0.09/GB (first 10TB)           â”‚  ~$10-20 (estimate)      â”‚
â”‚                                    â”‚                          â”‚
â”‚  VPC Endpoints                     â”‚  $0 (none)               â”‚
â”‚                                    â”‚                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  TOTAL (base only)                 â”‚  ~$31.20 + variable      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### New VPC Private (Monthly)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Resource                          â”‚  Cost/Month              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Internal ALB                      â”‚  $16.20                  â”‚
â”‚  â€¢ Base: $0.0225/hour Ã— 720h       â”‚  (same as current)       â”‚
â”‚                                    â”‚                          â”‚
â”‚  ALB Data Processing               â”‚  Variable                â”‚
â”‚  â€¢ $0.008/GB processed             â”‚  ~$5-10 (same)           â”‚
â”‚                                    â”‚                          â”‚
â”‚  Fargate Tasks (on-demand)         â”‚  Variable                â”‚
â”‚  â€¢ 256 CPU, 512 MB                 â”‚  $0.01/hour Ã— usage      â”‚
â”‚  â€¢ Dynamic scaling                 â”‚  (same as current)       â”‚
â”‚                                    â”‚                          â”‚
â”‚  VPC Endpoints (Bedrock)           â”‚  $14.40                  â”‚
â”‚  â€¢ $0.01/hour/AZ Ã— 2 AZ Ã— 720h     â”‚  ğŸ†• NEW COST             â”‚
â”‚                                    â”‚                          â”‚
â”‚  VPC Endpoints (ECR API)           â”‚  $14.40                  â”‚
â”‚  â€¢ $0.01/hour/AZ Ã— 2 AZ Ã— 720h     â”‚  ğŸ†• NEW COST (optional)  â”‚
â”‚                                    â”‚                          â”‚
â”‚  VPC Endpoints (ECR Docker)        â”‚  $14.40                  â”‚
â”‚  â€¢ $0.01/hour/AZ Ã— 2 AZ Ã— 720h     â”‚  ğŸ†• NEW COST (optional)  â”‚
â”‚                                    â”‚                          â”‚
â”‚  VPC Endpoints (S3 Gateway)        â”‚  $0                      â”‚
â”‚  â€¢ No hourly charge                â”‚  âœ… FREE                 â”‚
â”‚                                    â”‚                          â”‚
â”‚  VPC Endpoints Data Processing     â”‚  Variable                â”‚
â”‚  â€¢ $0.01/GB processed              â”‚  ~$5-10 (new)            â”‚
â”‚                                    â”‚                          â”‚
â”‚  Data Transfer OUT (reduced)       â”‚  Lower                   â”‚
â”‚  â€¢ Most traffic via VPC Endpoints  â”‚  ~$5-10 (reduced)        â”‚
â”‚                                    â”‚                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  TOTAL (with all VPC endpoints)    â”‚  ~$70.20 + variable      â”‚
â”‚  TOTAL (Bedrock only)              â”‚  ~$40.20 + variable      â”‚
â”‚                                    â”‚                          â”‚
â”‚  Additional Monthly Cost           â”‚  +$9-39 (depends on VPC  â”‚
â”‚                                    â”‚   endpoints needed)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cost Optimization:
  â€¢ Use only required VPC Endpoints (Bedrock = +$14.40/month)
  â€¢ Keep Fargate with Public IP for ECR access (save ~$28.80)
  â€¢ S3 Gateway Endpoint is free
  â€¢ Data transfer savings may offset VPC Endpoint costs
```

---

## 7ï¸âƒ£ Migration Path

### Phase 1: Preparation (Week 1)
```
Current State                Test Environment
     â”‚                            â”‚
     â”‚                            â”‚ Create Test VPC Endpoints
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> (Bedrock AgentCore)
     â”‚                            â”‚
     â”‚                            â”‚ Create Internal ALB (test)
     â”‚                            â”‚
     â”‚                            â”‚ Create Test Runtime (VPC mode)
     â”‚                            â”‚
     â”‚                            â”‚ Run connectivity tests
     â”‚                            â”‚
     â”‚                            âœ… Validation Complete
```

### Phase 2: Production Deployment (Week 2)
```
Current Prod                New VPC Private
     â”‚                            â”‚
     â”‚                            â”‚ Create Prod VPC Endpoints
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
     â”‚                            â”‚
     â”‚                            â”‚ Create Internal ALB (prod)
     â”‚  Still serving traffic     â”‚
     â”‚  â†“                          â”‚ Run parallel
     â”‚  Users â†’ Public ALB         â”‚
     â”‚                            â”‚
```

### Phase 3: Migration (Week 3)
```
                                   â”‚ Update AgentCore Runtime
                                   â”‚ to VPC mode
                                   â”‚
                                   â”‚ Update global_fargate_coordinator.py
                                   â”‚ to use Internal ALB DNS
                                   â†“
     Current Prod                New VPC Private
     â†“ (Deprecated)              âœ… (Active)
     â”‚                            â”‚
     â”‚                            â”‚ All traffic via private IPs
     â”‚                            â”‚
     Users â†’ (none)                â”‚ Monitor & Validate
                                   â”‚
                                   âœ… Migration Complete
```

### Phase 4: Cleanup (Week 4)
```
                                   â”‚ Verify stability (1 week)
                                   â”‚
                                   â”‚ Decommission old resources:
                                   â”‚ â€¢ Public ALB
                                   â”‚ â€¢ Old security groups
                                   â”‚ â€¢ Test environment
                                   â”‚
                                   âœ… Cleanup Complete
```

---

## 8ï¸âƒ£ Monitoring & Validation

### Key Metrics to Monitor

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Metric                          â”‚  Target      â”‚  Alert    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  VPC Endpoint Availability       â”‚  100%        â”‚  < 100%   â”‚
â”‚  AgentCore Runtime Status        â”‚  ACTIVE      â”‚  != ACTIVEâ”‚
â”‚  Internal ALB Healthy Targets    â”‚  > 0         â”‚  = 0      â”‚
â”‚  Private IP Usage in Logs        â”‚  100%        â”‚  < 100%   â”‚
â”‚  HTTP 5xx Errors                 â”‚  < 0.1%      â”‚  > 1%     â”‚
â”‚  Request Latency                 â”‚  < 500ms     â”‚  > 1000ms â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Validation Checklist

```
âœ… VPC Endpoints
   â””â”€ Check: aws ec2 describe-vpc-endpoints
   â””â”€ Verify: State = available
   â””â”€ Verify: Private DNS enabled

âœ… AgentCore Runtime
   â””â”€ Check: aws bedrock-agentcore get-runtime
   â””â”€ Verify: Status = ACTIVE
   â””â”€ Verify: Network Mode = VPC

âœ… Internal ALB
   â””â”€ Check: aws elbv2 describe-load-balancers
   â””â”€ Verify: Scheme = internal
   â””â”€ Verify: No public IP assigned

âœ… Security Groups
   â””â”€ Check: Rules allow only required traffic
   â””â”€ Verify: No 0.0.0.0/0 inbound (except Fargate outbound)

âœ… Private IP Usage
   â””â”€ Check: CloudWatch Logs
   â””â”€ Verify: Source IPs are 172.31.x.x (not public)

âœ… Connectivity
   â””â”€ Test: AgentCore â†’ Internal ALB â†’ Fargate
   â””â”€ Verify: All requests succeed
   â””â”€ Verify: No timeout errors
```

---

## ğŸ¯ Summary

### Current State
- âš ï¸ AgentCore â†’ Public IP â†’ ALB â†’ Fargate
- âš ï¸ Security Group wide open (0.0.0.0/0)
- âš ï¸ Internet exposure (minimal, but present)

### Target State
- âœ… AgentCore (VPC Mode) â†’ Private IP â†’ Internal ALB â†’ Fargate
- âœ… Zero Trust Security Groups
- âœ… 100% Private Network (no internet exposure)
- âœ… Compliance-ready architecture

### Migration Effort
- **Time**: 3-4 weeks
- **Risk**: Low (parallel deployment, easy rollback)
- **Cost**: +$9-39/month (depends on VPC Endpoints used)
- **Complexity**: Medium (well-documented, AWS managed)

---

**Ready to Start?**

Run the test environment:
```bash
./test_vpc_setup.sh
```

Refer to `TEST_VPC_README.md` for complete instructions!
